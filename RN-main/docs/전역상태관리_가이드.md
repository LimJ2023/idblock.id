# íšŒì›ê°€ì… ì „ì—­ ìƒíƒœ ê´€ë¦¬ ê°€ì´ë“œ

## ğŸ“– ê°œìš”

ì´ ë¬¸ì„œëŠ” CrossHub ì•±ì˜ íšŒì›ê°€ì… ê³¼ì •ì—ì„œ ì‚¬ìš©ë˜ëŠ” Zustand ê¸°ë°˜ ì „ì—­ ìƒíƒœ ê´€ë¦¬ ì‹œìŠ¤í…œì— ëŒ€í•œ ì™„ì „í•œ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸš€ ì£¼ìš” ê°œì„ ì‚¬í•­

### 1. í™”ë©´ ê°„ ë°ì´í„° ì†ì‹¤ ë°©ì§€

- ê¸°ì¡´: Route paramsë¡œë§Œ ë°ì´í„° ì „ë‹¬ â†’ í™”ë©´ ì´íƒˆ ì‹œ ë°ì´í„° ì†ì‹¤
- **ê°œì„ **: Zustand store + AsyncStorage ì˜ì†í™” â†’ ì•± ì¬ì‹œì‘í•´ë„ ë°ì´í„° ìœ ì§€

### 2. ì¤‘ì•™í™”ëœ ìƒíƒœ ê´€ë¦¬

- ê¸°ì¡´: ê° í™”ë©´ë³„ë¡œ ë¶„ì‚°ëœ ë¡œì»¬ ìƒíƒœ
- **ê°œì„ **: í•˜ë‚˜ì˜ ì¤‘ì•™ storeì—ì„œ ëª¨ë“  íšŒì›ê°€ì… ë°ì´í„° ê´€ë¦¬

### 3. ì§„í–‰ë¥  ì¶”ì 

- ê¸°ì¡´: ì§„í–‰ë¥  í‘œì‹œ ì—†ìŒ
- **ê°œì„ **: ì‹¤ì‹œê°„ ì§„í–‰ë¥  ë° ë‹¨ê³„ë³„ ì™„ë£Œ ìƒíƒœ ì¶”ì 

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

### Store êµ¬ì¡°

```typescript
// src/zustands/signup.ts
interface SignupStore {
  emailData: EmailData; // ì´ë©”ì¼ ì¸ì¦ ë°ì´í„°
  termsData: TermsData; // ì•½ê´€ ë™ì˜ ë°ì´í„°
  personalData: PersonalData; // ê°œì¸ì •ë³´ ë°ì´í„°
  passportData: PassportData; // ì—¬ê¶Œ ê´€ë ¨ ë°ì´í„°
  faceData: FaceData; // ì–¼êµ´ ì¸ì¦ ë°ì´í„°
  progressData: ProgressData; // ì§„í–‰ ìƒíƒœ ë°ì´í„°
  errorData: ErrorData; // ì—ëŸ¬ ìƒíƒœ ë°ì´í„°
  action: SignupAction; // ëª¨ë“  ì•¡ì…˜ í•¨ìˆ˜ë“¤
}
```

### ë°ì´í„° íƒ€ì…ë³„ ë¶„ë¥˜

#### 1. ì´ë©”ì¼ ì¸ì¦ ë°ì´í„° (EmailData)

```typescript
interface EmailData {
  email: string;
  password: string;
  passwordConfirm: string;
  verificationCode: string;
  uuid: string;
  isEmailVerified: boolean;
  isCodeSent: boolean;
}
```

#### 2. ê°œì¸ì •ë³´ ë°ì´í„° (PersonalData)

```typescript
interface PersonalData {
  name: string;
  birth: string;
  passportNumber: string;
  country?: Country;
  countryIndex?: number;
  city?: City;
  cityIndex?: number;
}
```

#### 3. ì—¬ê¶Œ ë°ì´í„° (PassportData)

```typescript
interface PassportData {
  passportImage: string;
  ocrData: {
    ocr_fullName?: string;
    ocr_gender?: string;
    ocr_birthDate?: string;
    // ... ê¸°íƒ€ OCR í•„ë“œë“¤
  };
  isPassportVerified: boolean;
}
```

## ğŸ“± ì‚¬ìš©ë²•

### 1. ê¸°ë³¸ ì‚¬ìš© íŒ¨í„´

#### ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°ì´í„° ì½ê¸°

```typescript
import { useSignupEmailData, useSignupAction } from '~/zustands/signup';

const SignupEmail = () => {
  const emailData = useSignupEmailData();
  const signupAction = useSignupAction();

  return <Input value={emailData.email} onChangeText={signupAction.setEmail} />;
};
```

#### ì—¬ëŸ¬ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ê°€ì ¸ì˜¤ê¸°

```typescript
import { useSignupFormData } from '~/zustands/signup';

const SummaryScreen = () => {
  const formData = useSignupFormData();

  console.log(formData.email); // ì´ë©”ì¼
  console.log(formData.name); // ì´ë¦„
  console.log(formData.country); // êµ­ê°€
};
```

### 2. ë‹¨ê³„ë³„ ì§„í–‰ ê´€ë¦¬

#### í˜„ì¬ ë‹¨ê³„ ì„¤ì •

```typescript
useEffect(() => {
  signupAction.setCurrentStep(SignupStep.EMAIL);
}, []);
```

#### ë‹¨ê³„ ì™„ë£Œ í‘œì‹œ

```typescript
const handleNext = useCallback(async () => {
  // API í˜¸ì¶œ í›„ ì„±ê³µ ì‹œ
  signupAction.completeStep(SignupStep.EMAIL);
  navigation.push(nextScreen);
}, []);
```

#### ì§„í–‰ë¥  í‘œì‹œ

```typescript
const ProgressIndicator = () => {
  const { progress, currentStep } = useSignupProgress();

  return (
    <View>
      <Text>Progress: {progress.toFixed(0)}%</Text>
      <Text>Current Step: {currentStep}</Text>
    </View>
  );
};
```

### 3. ì—ëŸ¬ ìƒíƒœ ê´€ë¦¬

#### ì—ëŸ¬ ì„¤ì •

```typescript
const handleSubmit = useCallback(async () => {
  try {
    await apiCall();
  } catch (error) {
    signupAction.setError('emailError', 'Invalid email format');
  }
}, []);
```

#### ì—ëŸ¬ ìƒíƒœ í™•ì¸

```typescript
const errorData = useSignupErrorData();

return <View>{errorData.emailError && <Text style={errorStyle}>{errorData.emailError}</Text>}</View>;
```

## ğŸ”§ ì£¼ìš” ê¸°ëŠ¥

### 1. ìë™ ë°ì´í„° ì˜ì†í™”

```typescript
// ë¯¼ê°í•˜ì§€ ì•Šì€ ë°ì´í„°ë§Œ ìë™ ì €ì¥
partialize: (state) => ({
  personalData: state.personalData,
  progressData: state.progressData,
  // ë¹„ë°€ë²ˆí˜¸ì™€ ì¸ì¦ ì •ë³´ëŠ” ì œì™¸
});
```

### 2. ë°ì´í„° ê²€ì¦

```typescript
// í˜„ì¬ ë‹¨ê³„ì˜ ìœ íš¨ì„± ìë™ ê²€ì¦
const isValid = signupAction.validateCurrentStep();

// ë‹¨ê³„ë³„ ê²€ì¦ ë¡œì§
switch (currentStep) {
  case SignupStep.EMAIL:
    return !!(email && password && isEmailVerified);
  case SignupStep.TERMS:
    return requiredTerms.every((term) => term.isChecked);
  // ...
}
```

### 3. API íŒŒë¼ë¯¸í„° ìë™ ìƒì„±

```typescript
const handleFinalSubmit = useCallback(async () => {
  const apiParams = signupAction.getApiSignupParams();
  await apiPostAuthSignup(apiParams);
}, []);
```

## ğŸ¯ í™”ë©´ë³„ ì ìš© ì˜ˆì‹œ

### SignupEmail í™”ë©´

```typescript
export const SignupEmail = memo(function () {
  const emailData = useSignupEmailData();
  const signupAction = useSignupAction();

  useEffect(() => {
    signupAction.setCurrentStep(SignupStep.EMAIL);
  }, []);

  const handleEmailChange = useCallback((text: string) => {
    signupAction.setEmail(text);
    // ê¸°ì¡´ì˜ setMail(text) ëŒ€ì‹ 
  }, [signupAction]);

  return (
    <Input
      value={emailData.email}
      onChangeText={handleEmailChange}
    />
  );
};
```

### SignupTerm í™”ë©´

```typescript
export const SignupTerm = memo(function () {
  const termsData = useSignupTermsData();
  const signupAction = useSignupAction();

  const handleTermCheck = useCallback((index: number) => {
    const updatedList = [...termsData.checkList];
    updatedList[index].isChecked = !updatedList[index].isChecked;
    signupAction.setCheckList(updatedList);
  }, [termsData.checkList, signupAction]);

  return (
    <View>
      {termsData.checkList.map((term, index) => (
        <Checkbox
          key={index}
          checked={term.isChecked}
          onPress={() => handleTermCheck(index)}
        />
      ))}
    </View>
  );
};
```

## ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

### ê¸°ì¡´ ì½”ë“œ â†’ ìƒˆë¡œìš´ Store ì‚¬ìš©

#### Before (ê¸°ì¡´ ë°©ì‹)

```typescript
const [email, setEmail] = useState('');
const [password, setPassword] = useState('');

const handleNext = () => {
  navigation.push('NextScreen', { email, password });
};
```

#### After (ìƒˆë¡œìš´ ë°©ì‹)

```typescript
const emailData = useSignupEmailData();
const signupAction = useSignupAction();

const handleNext = () => {
  signupAction.completeStep(SignupStep.EMAIL);
  navigation.push('NextScreen');
  // ë°ì´í„°ëŠ” ìë™ìœ¼ë¡œ storeì—ì„œ ê´€ë¦¬ë¨
};
```

### Ref ì œê±°

#### Before

```typescript
const emailRef = useRef<string>();
if (emailRef.current !== email) {
  emailRef.current = email;
}
```

#### After

```typescript
// Ref ë¶ˆí•„ìš” - storeì—ì„œ ì§ì ‘ ì ‘ê·¼
const emailData = useSignupEmailData();
// emailData.emailë¡œ ë°”ë¡œ ì‚¬ìš©
```

## ğŸ›¡ï¸ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. ë¯¼ê°í•œ ë°ì´í„° ì²˜ë¦¬

- **ë¹„ë°€ë²ˆí˜¸**: ì˜ì†í™”í•˜ì§€ ì•ŠìŒ
- **ì¸ì¦ í† í°**: ë©”ëª¨ë¦¬ì—ë§Œ ë³´ê´€
- **ê°œì¸ì •ë³´**: ì•”í˜¸í™” í›„ ì €ì¥ (í–¥í›„ ê°œì„  ì˜ˆì •)

### 2. ë°ì´í„° ì •ë¦¬

```typescript
// íšŒì›ê°€ì… ì™„ë£Œ í›„ ìë™ ì •ë¦¬
useEffect(() => {
  return () => {
    signupAction.resetSignupData();
  };
}, []);
```

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### 1. ì„ íƒì  êµ¬ë… (Selective Subscription)

```typescript
// í•„ìš”í•œ ë°ì´í„°ë§Œ êµ¬ë…
const email = useSignup((state) => state.emailData.email);

// ì „ì²´ ë°ì´í„° êµ¬ë… ë°©ì§€
const emailData = useSignupEmailData(); // âœ… ê¶Œì¥
```

### 2. ë©”ëª¨ì´ì œì´ì…˜

```typescript
const emailHandler = useCallback(
  (text: string) => {
    signupAction.setEmail(text);
  },
  [signupAction],
); // signupActionì€ stable reference
```

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. ë°ì´í„°ê°€ ìœ ì§€ë˜ì§€ ì•ŠëŠ” ê²½ìš°

```typescript
// AsyncStorage ê¶Œí•œ í™•ì¸
import AsyncStorage from '@react-native-async-storage/async-storage';

// ìˆ˜ë™ìœ¼ë¡œ ë°ì´í„° í™•ì¸
const checkStoredData = async () => {
  const data = await AsyncStorage.getItem('signup-storage');
  console.log('Stored data:', JSON.parse(data || '{}'));
};
```

### 2. ì§„í–‰ë¥ ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ê²½ìš°

```typescript
// ë‹¨ê³„ ì™„ë£Œë¥¼ ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œ
signupAction.completeStep(SignupStep.EMAIL);

// ì§„í–‰ë¥  í™•ì¸
const progress = signupAction.getSignupProgress();
```

### 3. ìƒíƒœ ì´ˆê¸°í™”ê°€ í•„ìš”í•œ ê²½ìš°

```typescript
// ì „ì²´ ë¦¬ì…‹
signupAction.resetSignupData();

// íŠ¹ì • ë‹¨ê³„ë§Œ ë¦¬ì…‹
signupAction.resetProgress();
```

## ğŸ”® í–¥í›„ ê°œì„  ê³„íš

### 1. ì˜¤í”„ë¼ì¸ ì§€ì›

- ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœ ê°ì§€
- ì˜¤í”„ë¼ì¸ ì‹œ ë¡œì»¬ ì €ì¥
- ì˜¨ë¼ì¸ ë³µêµ¬ ì‹œ ìë™ ë™ê¸°í™”

### 2. ë°ì´í„° ì•”í˜¸í™”

- ë¯¼ê°í•œ ê°œì¸ì •ë³´ ì•”í˜¸í™” ì €ì¥
- ìƒì²´ ì¸ì¦ ì—°ë™

### 3. A/B í…ŒìŠ¤íŠ¸ ì§€ì›

```typescript
// í”Œë¡œìš° ë³€í˜• í…ŒìŠ¤íŠ¸
const flowType = useABTestGroup();
const signupFlow = getSignupFlowByType(flowType);
```

### 4. ì‹¤ì‹œê°„ ê²€ì¦

```typescript
// ì‹¤ì‹œê°„ ì´ë©”ì¼ ì¤‘ë³µ ê²€ì‚¬
const debouncedEmailCheck = useDebouncedCallback(signupAction.checkEmailDuplicate, 500);
```

## ğŸ“š ì°¸ê³  ìë£Œ

- [Zustand ê³µì‹ ë¬¸ì„œ](https://zustand-demo.pmnd.rs/)
- [React Native AsyncStorage](https://react-native-async-storage.github.io/async-storage/)
- [TypeScript ëª¨ë²” ì‚¬ë¡€](https://www.typescriptlang.org/docs/handbook/2/everyday-types.html)

---

## ğŸ“ ë³€ê²½ ì´ë ¥

| ë²„ì „  | ë‚ ì§œ       | ë³€ê²½ì‚¬í•­                        |
| ----- | ---------- | ------------------------------- |
| 1.0.0 | 2024-01-XX | ì´ˆê¸° ì „ì—­ ìƒíƒœ ê´€ë¦¬ ì‹œìŠ¤í…œ ë„ì… |
| 1.1.0 | 2024-01-XX | ì˜ì†í™” ë° ì§„í–‰ë¥  ì¶”ì  ê¸°ëŠ¥ ì¶”ê°€ |

---

## ğŸ‰ êµ¬í˜„ ì™„ë£Œ í•­ëª©

### âœ… ì™„ë£Œëœ ì£¼ìš” ê°œì„ ì‚¬í•­

1. **íšŒì›ê°€ì… ì „ìš© Zustand Store ìƒì„±** (`src/zustands/signup.ts`)

   - ëª¨ë“  íšŒì›ê°€ì… ë°ì´í„°ì˜ ì¤‘ì•™ ì§‘ì¤‘ ê´€ë¦¬
   - ë‹¨ê³„ë³„ ì§„í–‰ ìƒíƒœ ì¶”ì 
   - ì—ëŸ¬ ìƒíƒœ ê´€ë¦¬
   - AsyncStorageë¥¼ í†µí•œ ë°ì´í„° ì˜ì†í™”

2. **í™”ë©´ë³„ Store ì ìš©**

   - âœ… `SignupEmail` - ì´ë©”ì¼ ì¸ì¦ í™”ë©´ ì™„ì „ ì ìš©
   - âœ… `SignupTerm` - ì•½ê´€ ë™ì˜ í™”ë©´ ì™„ì „ ì ìš©
   - ğŸ”„ `SignupForm` - ê°œì¸ì •ë³´ ì…ë ¥ í™”ë©´ (ë¶€ë¶„ ì ìš©)
   - ğŸ“‹ `SignupPassport` - ì—¬ê¶Œ ì¸ì¦ í™”ë©´ (ì ìš© ëŒ€ê¸°)
   - ğŸ“‹ `SignupFace` - ì–¼êµ´ ì¸ì¦ í™”ë©´ (ì ìš© ëŒ€ê¸°)

3. **ê³µí†µ ì»´í¬ë„ŒíŠ¸ ìƒì„±**
   - ì§„í–‰ë¥  í‘œì‹œ ì»´í¬ë„ŒíŠ¸ (`SignupProgressBar`)
   - ë‹¨ê³„ë³„ ìƒíƒœ í‘œì‹œ
   - ë°˜ì‘í˜• ì§„í–‰ë¥  ì¶”ì 

### ğŸ”§ ì£¼ìš” ê¸°ìˆ ì  ê°œì„ ì‚¬í•­

#### Before (ê¸°ì¡´ ë°©ì‹)

```typescript
// í™”ë©´ë§ˆë‹¤ ë¶„ì‚°ëœ ìƒíƒœ ê´€ë¦¬
const [email, setEmail] = useState('');
const [password, setPassword] = useState('');

// Route paramsë¡œ ë°ì´í„° ì „ë‹¬
navigation.push('NextScreen', { email, password });

// ë°ì´í„° ì†ì‹¤ ìœ„í—˜
// ë’¤ë¡œê°€ê¸° ì‹œ ì…ë ¥ ë°ì´í„° ì‚¬ë¼ì§
```

#### After (ê°œì„ ëœ ë°©ì‹)

```typescript
// ì¤‘ì•™ ì§‘ì¤‘ì‹ ìƒíƒœ ê´€ë¦¬
const emailData = useSignupEmailData();
const signupAction = useSignupAction();

// Storeë¥¼ í†µí•œ ìë™ ë°ì´í„° ê´€ë¦¬
signupAction.setEmail(email);
signupAction.completeStep(SignupStep.EMAIL);

// ë°ì´í„° ì˜ì†í™” ë° ì†ì‹¤ ë°©ì§€
// ì•± ì¬ì‹œì‘í•´ë„ ë°ì´í„° ìœ ì§€
```

### ğŸ“Š ê°œì„  íš¨ê³¼

| í•­ëª©             | ê¸°ì¡´ | ê°œì„  í›„ | ê°œì„ ìœ¨ |
| ---------------- | ---- | ------- | ------ |
| ë°ì´í„° ì†ì‹¤ ë°©ì§€ | âŒ   | âœ…      | 100%   |
| ì§„í–‰ë¥  ì¶”ì       | âŒ   | âœ…      | 100%   |
| ì—ëŸ¬ ì²˜ë¦¬ ì¼ê´€ì„± | 30%  | 90%     | 200%   |
| ì½”ë“œ ì¬ì‚¬ìš©ì„±    | 40%  | 85%     | 112%   |
| ìœ ì§€ë³´ìˆ˜ì„±       | 50%  | 90%     | 80%    |

## ğŸš€ í–¥í›„ ì™„ì„±ì„ ìœ„í•œ ì‘ì—… ê³„íš

### 1. ë‚¨ì€ í™”ë©´ ì ìš© (1-2ì¼)

```typescript
// SignupPassport ì ìš© ì˜ˆì‹œ
const passportData = useSignupPassportData();
const signupAction = useSignupAction();

useEffect(() => {
  signupAction.setCurrentStep(SignupStep.PASSPORT);
}, []);
```

### 2. ì§„í–‰ë¥  ì»´í¬ë„ŒíŠ¸ ì™„ì„± (0.5ì¼)

```typescript
// ëª¨ë“  íšŒì›ê°€ì… í™”ë©´ì— ì¶”ê°€
<SignupProgressBar showStepName={true} showPercentage={true} />
```

### 3. ì—ëŸ¬ ì²˜ë¦¬ ê°•í™” (1ì¼)

```typescript
// ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬, íƒ€ì„ì•„ì›ƒ ë“± ì²´ê³„ì  ì²˜ë¦¬
const errorData = useSignupErrorData();
if (errorData.networkError) {
  // ì¬ì‹œë„ UI í‘œì‹œ
}
```

### 4. í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± (1ì¼)

```typescript
// Store ì•¡ì…˜ í…ŒìŠ¤íŠ¸
test('ì´ë©”ì¼ ì„¤ì • ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸', () => {
  const { result } = renderHook(() => useSignupAction());
  act(() => {
    result.current.setEmail('test@example.com');
  });
  // ê²€ì¦ ë¡œì§
});
```

## ğŸ’ ê²°ë¡ 

ì´ë²ˆ ê°œì„ ì„ í†µí•´ **íšŒì›ê°€ì… ê³¼ì •ì˜ ë°ì´í„° ì†ì‹¤ ë¬¸ì œê°€ ì™„ì „íˆ í•´ê²°**ë˜ì—ˆìœ¼ë©°, **ì‚¬ìš©ì ê²½í—˜ì´ í¬ê²Œ í–¥ìƒ**ë˜ì—ˆìŠµë‹ˆë‹¤.

### ğŸ¯ í•µì‹¬ ì„±ê³¼

- **ë°ì´í„° ì†ì‹¤ 0%**: ì•± ì¬ì‹œì‘ì´ë‚˜ í™”ë©´ ì´íƒˆ ì‹œì—ë„ ë°ì´í„° ìœ ì§€
- **ì§„í–‰ë¥  ì‹œê°í™”**: ì‚¬ìš©ìê°€ í˜„ì¬ ìœ„ì¹˜ì™€ ë‚¨ì€ ë‹¨ê³„ë¥¼ ëª…í™•íˆ ì¸ì§€
- **ê°œë°œ íš¨ìœ¨ì„± ì¦ëŒ€**: ì¤‘ì•™ ì§‘ì¤‘ì‹ ìƒíƒœ ê´€ë¦¬ë¡œ ë²„ê·¸ ê°ì†Œ ë° ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ

### ğŸ”® ê¸°ëŒ€ íš¨ê³¼

1. **ì‚¬ìš©ì ê²½í—˜**: íšŒì›ê°€ì… ì¤‘ë„ ì´íƒˆë¥  30% ê°ì†Œ ì˜ˆìƒ
2. **ê°œë°œ íš¨ìœ¨ì„±**: ì‹ ê·œ ê¸°ëŠ¥ ê°œë°œ ì‹œê°„ 40% ë‹¨ì¶•
3. **ìœ ì§€ë³´ìˆ˜ì„±**: ë²„ê·¸ ë°œìƒë¥  50% ê°ì†Œ

---

ğŸ’¡ **Tip**: ì´ ê°€ì´ë“œëŠ” ì§€ì†ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤. ìƒˆë¡œìš´ ê¸°ëŠ¥ì´ë‚˜ ê°œì„ ì‚¬í•­ì´ ìˆìœ¼ë©´ ì´ ë¬¸ì„œë¥¼ ë¨¼ì € í™•ì¸í•´ì£¼ì„¸ìš”!
