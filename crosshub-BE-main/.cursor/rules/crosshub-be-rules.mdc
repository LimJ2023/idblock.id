---
description: 
globs: 
alwaysApply: false
---
# Crosshub ë°±ì—”ë“œ í”„ë¡œì íŠ¸ ê°€ì´ë“œ

## ğŸš€ í”„ë¡œì íŠ¸ ê°œìš”
ì´ í”„ë¡œì íŠ¸ëŠ” **NestJS** ê¸°ë°˜ì˜ ë©€í‹° ìŠ¤ì½”í”„ ë°±ì—”ë“œ API ì„œë²„ì…ë‹ˆë‹¤. API_SCOPE í™˜ê²½ ë³€ìˆ˜ì— ë”°ë¼ ë‹¤ë¥¸ ëª¨ë“œë¡œ ë™ì‘í•©ë‹ˆë‹¤.

## ğŸ“‹ ê¸°ìˆ  ìŠ¤íƒ
- **í”„ë ˆì„ì›Œí¬**: NestJS (TypeScript ê¸°ë°˜)
- **ì–¸ì–´**: TypeScript  
- **ORM**: Drizzle ORM with PostgreSQL
- **ì¸ì¦**: JWT + Cookie ê¸°ë°˜ ì¸ì¦
- **íŒŒì¼ ìŠ¤í† ë¦¬ì§€**: AWS S3, Google Cloud Storage
- **ì´ë©”ì¼**: Resend, AWS SES
- **í‘¸ì‹œ ì•Œë¦¼**: Firebase FCM  
- **ë¸”ë¡ì²´ì¸**: Thirdweb
- **íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €**: pnpm
- **í…ŒìŠ¤íŠ¸**: Jest
- **API ë¬¸ì„œ**: Swagger + Scalar

## ğŸ—ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡°

### ğŸ“ ë©”ì¸ ì§„ì…ì 
- [src/main.ts](mdc:src/main.ts): ì• í”Œë¦¬ì¼€ì´ì…˜ ë¶€íŠ¸ìŠ¤íŠ¸ë© ë° ê¸€ë¡œë²Œ ì„¤ì •
- [src/app.module.ts](mdc:src/app.module.ts): ë£¨íŠ¸ ëª¨ë“ˆ, API_SCOPEì— ë”°ë¥¸ ì¡°ê±´ë¶€ ëª¨ë“ˆ ë¡œë”©

### ğŸ” ì¸ì¦ ëª¨ë“ˆë“¤
- [src/auth/](mdc:src/auth): ê¸°ë³¸ ì‚¬ìš©ì ì¸ì¦ (JWT)
- [src/admin-auth/](mdc:src/admin-auth): ê´€ë¦¬ì ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬
- [src/manager-auth/](mdc:src/manager-auth): ì‚¬ì´íŠ¸ ë§¤ë‹ˆì € ì¸ì¦

### ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤
- [src/database/](mdc:src/database): ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë° ì„¤ì •
- [src/database/schema/](mdc:src/database/schema): Drizzle ìŠ¤í‚¤ë§ˆ ì •ì˜
- [drizzle.config.ts](mdc:drizzle.config.ts): Drizzle ORM ì„¤ì •
- [drizzle/](mdc:drizzle): ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ë“¤

### ğŸ”§ í•µì‹¬ ëª¨ë“ˆë“¤
- [src/user/](mdc:src/user): ì‚¬ìš©ì ê´€ë¦¬ (ì–¼êµ´ ì¸ì‹ í¬í•¨)
- [src/site/](mdc:src/site): ì‚¬ì´íŠ¸ ê´€ë¦¬ (ê´€ë¦¬ì/ë§¤ë‹ˆì €/í¼ë¸”ë¦­ ì»¨íŠ¸ë¡¤ëŸ¬ ë¶„ë¦¬)
- [src/visitor/](mdc:src/visitor): ë°©ë¬¸ì ê´€ë¦¬
- [src/notification/](mdc:src/notification): í‘¸ì‹œ ì•Œë¦¼ ê´€ë¦¬
- [src/review/](mdc:src/review): ì‚¬ì´íŠ¸ ë°©ë¬¸ ë¦¬ë·° ê´€ë¦¬

### â˜ï¸ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™
- [src/s3/](mdc:src/s3): AWS S3 íŒŒì¼ ì—…ë¡œë“œ
- [src/gcp/](mdc:src/gcp): Google Cloud Storage
- [src/firebase/](mdc:src/firebase): Firebase FCM í‘¸ì‹œ ì•Œë¦¼
- [src/email/](mdc:src/email): ì´ë©”ì¼ ì„œë¹„ìŠ¤ (Resend, AWS SES)
- [src/thirdweb/](mdc:src/thirdweb): ë¸”ë¡ì²´ì¸ ì—°ë™
- [src/argos/](mdc:src/argos): ì–¼êµ´ ì¸ì‹ API

### ğŸ”Œ API ë° ê³µí†µ ëª¨ë“ˆ
- [src/api/](mdc:src/api): ì™¸ë¶€ API í‚¤ ê´€ë¦¬ ë° ì™¸ë¶€ API ì—”ë“œí¬ì¸íŠ¸
- [src/common/](mdc:src/common): ê³µí†µ ìœ í‹¸ë¦¬í‹° ë° ì„œë¹„ìŠ¤
- [src/env/](mdc:src/env): í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬ ë° ê²€ì¦

### ğŸ› ï¸ ìœ í‹¸ë¦¬í‹°
- [src/lib/typeschema/](mdc:src/lib/typeschema): Valibot ê¸°ë°˜ íƒ€ì… ìŠ¤í‚¤ë§ˆ ë° ê²€ì¦
- [src/interceptors/](mdc:src/interceptors): ë¡œê¹… ë° ì‘ë‹µ ë³€í™˜ ì¸í„°ì…‰í„°

## ğŸ”„ API ìŠ¤ì½”í”„ ì‹œìŠ¤í…œ
í”„ë¡œì íŠ¸ëŠ” `API_SCOPE` í™˜ê²½ ë³€ìˆ˜ì— ë”°ë¼ ë‹¤ë¥¸ ëª¨ë“œë¡œ ë™ì‘:

- **PUBLIC**: ì¼ë°˜ ì‚¬ìš©ì API ([src/app.controller.ts](mdc:src/app.controller.ts))
- **ADMIN**: ê´€ë¦¬ì API ([src/admin-auth/admin-auth.controller.ts](mdc:src/admin-auth/admin-auth.controller.ts))
- **MANAGER**: ì‚¬ì´íŠ¸ ë§¤ë‹ˆì € API ([src/manager-auth/manager-auth.controller.ts](mdc:src/manager-auth/manager-auth.controller.ts))
- **EXTERNAL_API**: ì™¸ë¶€ API ([src/api/external.controller.ts](mdc:src/api/external.controller.ts))

## ğŸ“ ê°œë°œ íŒ¨í„´

### ëª¨ë“ˆ êµ¬ì¡°
ê° ëª¨ë“ˆì€ ë‹¤ìŒ íŒ¨í„´ì„ ë”°ë¦…ë‹ˆë‹¤:
- `*.module.ts`: ëª¨ë“ˆ ì •ì˜
- `*.controller.ts`: ì»¨íŠ¸ë¡¤ëŸ¬ (ì—¬ëŸ¬ ìŠ¤ì½”í”„ë³„ë¡œ ë¶„ë¦¬ ê°€ëŠ¥)
- `*.service.ts`: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
- `*.dto.ts`: ë°ì´í„° ì „ì†¡ ê°ì²´ (Valibot ìŠ¤í‚¤ë§ˆ ì‚¬ìš©)

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
- [src/database/schema/index.ts](mdc:src/database/schema/index.ts)ì—ì„œ ëª¨ë“  ìŠ¤í‚¤ë§ˆ export
- Drizzle ORM ì‚¬ìš©, camelCase ì»¨ë²¤ì…˜
- PostgreSQL + PostGIS í™•ì¥ ì‚¬ìš©

### ì¸ì¦ ë° ê¶Œí•œ
- JWT í† í° + ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦
- ê´€ë¦¬ì ê¶Œí•œ ë°ì½”ë ˆì´í„°: [src/auth/admin-permission.decorator.ts](mdc:src/auth/admin-permission.decorator.ts)
- ê°€ë“œ: [src/auth/auth.guard.ts](mdc:src/auth/auth.guard.ts), [src/auth/admin-permission.guard.ts](mdc:src/auth/admin-permission.guard.ts)

## ğŸš€ ê°œë°œ ëª…ë ¹ì–´

```bash
# ê°œë°œ ì„œë²„ ì‹œì‘ (API + Drizzle Studio)
pnpm dev

# API ì„œë²„ë§Œ ì‹œì‘
pnpm start:dev

# Drizzle Studio ì‹œì‘
pnpm start:studio

# ë¹Œë“œ
pnpm build

# í…ŒìŠ¤íŠ¸
pnpm test

# ì–¼êµ´ ì¸ì‹ í…ŒìŠ¤íŠ¸
pnpm test:face-compare
```

## ğŸ” ì£¼ìš” ê¸°ëŠ¥

### ì–¼êµ´ ì¸ì‹
- Argos API ì—°ë™ì„ í†µí•œ ì–¼êµ´ ë¹„êµ ê¸°ëŠ¥
- [src/user/face-compare-test.util.ts](mdc:src/user/face-compare-test.util.ts): ì–¼êµ´ ë¹„êµ ìœ í‹¸ë¦¬í‹°
- [test-images/faces/](mdc:test-images/faces): í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ë“¤

### íŒŒì¼ ì—…ë¡œë“œ
- AWS S3ì™€ GCP ë‘ ê°€ì§€ ìŠ¤í† ë¦¬ì§€ ì§€ì›
- ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• (Sharp ì‚¬ìš©)
- í”„ë¦¬ì‚¬ì¸ë“œ URL ìƒì„±

### ì•Œë¦¼ ì‹œìŠ¤í…œ
- Firebase FCM í‘¸ì‹œ ì•Œë¦¼
- ì´ë©”ì¼ ì•Œë¦¼ (Resend, AWS SES)

## ğŸŒ í”„ë¡ íŠ¸ì—”ë“œ í†µí•©
- [admin-fe/](mdc:admin-fe): ê´€ë¦¬ì í”„ë¡ íŠ¸ì—”ë“œ (ì •ì  íŒŒì¼)
- [manager-fe/](mdc:manager-fe): ë§¤ë‹ˆì € í”„ë¡ íŠ¸ì—”ë“œ (ì •ì  íŒŒì¼)
- API_SCOPEì— ë”°ë¼ í•´ë‹¹ í”„ë¡ íŠ¸ì—”ë“œ ì„œë¹™

## ğŸ“š ì¶”ê°€ ë¦¬ì†ŒìŠ¤
- [ADMIN_PERMISSIONS.md](mdc:ADMIN_PERMISSIONS.md): ê´€ë¦¬ì ê¶Œí•œ ê°€ì´ë“œ
- [FACE_COMPARE_TEST.md](mdc:FACE_COMPARE_TEST.md): ì–¼êµ´ ë¹„êµ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ
- [scripts/](mdc:scripts): ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸ë“¤